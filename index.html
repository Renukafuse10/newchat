<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <title>Ask a Question</title>
  </head>
  <style>
body {
  font-family: "Montserrat", sans-serif;
  width: 100%;
 
  height: 100vh;
  margin: 0;
  background-color: #f0f4ff;
  overflow: hidden; /* Prevent page scrolling */
}

.container {
  background-color: #f0f4ff;
  border-radius: 0.6em;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100%;
}

.headerContainer {
  padding: 1.3em 0;
  width: 100%;
  display: flex;
  justify-content: center;
  background-color: black;
  color: white;
  align-items: center;
}

.header {
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;


}

img {
width: 20%;
}

h1 {
  margin: 0;
  font-size: 1.8em;
}

.message-container {
margin: 1.5em 0;

  width: 90%;
  height: 75vh; /* Adjust as needed */
  background-color: #ffffff;
  display: flex;
  align-items: center;
  flex-direction: column;
  border-radius: 0.6em;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  padding: 0em; /* Optional: adds padding inside the container */
  box-sizing: border-box; /* Includes padding and border in the element's total width and height */
}

.message-content {
  display: flex;
  justify-content: center;
  flex-direction: column;
  align-items: center;
  overflow-y: auto;
  width: 100%;
  height: calc(100% - 60px); /* Adjust height to accommodate for form */
  padding: 0em;

  box-sizing: border-box;
}

.input-text {
  padding: 0em;
}

textarea {
  resize: none;
  padding: 10px;
  font-size: 16px;
  margin-bottom: 10px;
  border-radius: 4px;
  border: 1px solid #ccc;
  width: 100%; /* Ensure textarea takes full width */
}

button {
  padding: 10px;
  font-size: 16px;
  border: none;
  border-radius: 4px;
  background-color: #007bff;
  color: white;
  cursor: pointer;
}

button:hover {
  background-color: #0056b3;
}

.messages {
    width: 100%;
  flex: 1;
  overflow-y: auto;
  margin-bottom: 10px;
  display: flex;
  flex-direction: column;
}

.message {
  padding: 10px;
  border-radius: 8px;
  margin: 5px 0;
  max-width: 80%;
}
.firstMsg{
  color: #786F6F;
  font-weight: 500 !important;
  font-size: 1.05em;
  margin-left: 5em;
  margin-top: 3em;
}

.prompts {

 width: 100%;
  background-color: #ffffff;
  padding: 0px 0px;
  display: flex;
  justify-content: space-between;
  gap: 20px;
}

.prompt {
  margin-bottom: 1em;
    text-align: start;
    padding: 0.6em 1em;
border: 1.3px solid #ADC3FF !important;
  color: #90A3D8;
  background-color: white;
  border: none;
  border-radius: 5px;
 font-family: "Montserrat", sans-serif;
  cursor: pointer;
 font-weight: 600 !important;
  font-size: 1em;
  width: 15em;
}
p{
font-weight: 400 !important;
  font-size: 0.9em;
  margin: 0.1em 0;
}

.prompt:hover {
background-color: none !important;
}
button:hover{
background-color: transparent !important;

}

.question {
  margin-top: 1em;
  align-self: flex-end;
  background-color: #EFEFEF;
  /* color: white; */
  color: #585B62;
    font-size: 1.05em;
  border-radius: 2em;
  font-weight: 500;
  padding: 0.96em 2em;
  margin-right: 5em;
}

.chat-input {
  width: 100%;
  display: flex;
  gap: 1em;
  
}
textarea{
    width: 100%;
    background-color: #F0F4FF;
    border: none;
    border-radius: 2em;
    outline: none;
     font-family: "Montserrat", sans-serif;
   padding:  1em 2em 0em 2em;
   font-weight: 550;
   color: #585B62;
   font-size: 1.01em;
}
form{
    width: 80%;
}

.submitbtn{
   font-family: "Montserrat", sans-serif;
    background-color: #193948;
    display: flex;
    align-items: center;
    gap: 1em;
  border-radius: 2em;
  height: 3.1em;
  font-weight: 600;
    padding: 0 1em;
}
.submitbtn:hover{
    background-color:#193948 !important ;
}
.sendimg{
    width: 2em;
    height: 2em !important;
}
.answer {
  align-self: flex-start;
  background-color: #ffffff;
  color: #434446;
  font-weight: 500;
  font-size: 1.05em;
  margin-left: 5em;
}

#loading {
  display: none;
  text-align: center;
  font-size: 16px;
  color: #193948;

margin: 0.5em 0;
}
#loadingImage {
 
  display: block;
  margin: 2em auto; /* Centers the image horizontally */
  width: 8em; /* Adjust size as needed */
  height: 8em; /* Adjust size as needed */
}
#centerImageContainer{
  
  display: block;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
}
svg{
 
  width: 100px;
  height: 40px;
  margin: 0px;
  display:inline-block;
}



  </style>

  <body>
    <div class="container">
      <div class="headerContainer">
        <div class="header">
         
            <img src="./logoimage.png" alt="sms logo" />
      
         
        </div>
      </div>
      <div class="message-container">

        <div class="message-content">
          

          <div class="messages" id="messages">
            
            <p class="firstMsg">Hi, Iâ€™m your personal assistant. How can I help you with ?</p>
            <div id="centerImageContainer">
            <img id="loadingImage" src="./bgimage.svg" class="centerImage" alt="Loading...">

            </div>

          </div>
          <div class="input-text">
            <div id="loading"> <svg version="1.1" id="L4" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
  viewBox="0 0 100 100" enable-background="new 0 0 0 0" xml:space="preserve">
  <circle fill="#193948" stroke="none" cx="6" cy="50" r="6">
    <animate
      attributeName="opacity"
      dur="1s"
      values="0;1;0"
      repeatCount="indefinite"
      begin="0.1"/>    
  </circle>
  <circle fill="#193948"stroke="none" cx="26" cy="50" r="6">
    <animate
      attributeName="opacity"
      dur="1s"
      values="0;1;0"
      repeatCount="indefinite" 
      begin="0.2"/>       
  </circle>
  <circle fill="#193948" stroke="none" cx="46" cy="50" r="6">
    <animate
      attributeName="opacity"
      dur="1s"
      values="0;1;0"
      repeatCount="indefinite" 
      begin="0.3"/>     
  </circle>
</svg>
</div>

            <div class="prompts">
              <button class="prompt" onclick="handleSuggestion('Please give me all the customer names with customers\' no.')">
                Tell me the total number <p>of customers?</p>
              </button>
              <button class="prompt" onclick="handleSuggestion('What is this data about?')">What is this data about?</button>
              <!-- <button class="prompt" onclick="handleSuggestion('Please give me all partial clearance of bill for the customer SPARK MALL AND PARKING PRIVATE LIMI')">
               Please give me all partial clearance of bill for the customer SPARK MALL AND PARKING PRIVATE LIMI
              </button> -->
            </div>
          </div>
          </div>
          <form id="questionForm">
            <div class="chat-input">
              <textarea
                id="question"
                placeholder="Type your question here..."
                required
              ></textarea>
              <button type="submit" class="submitbtn">
              Send  <img src="./send.svg" alt="vector" class="sendimg" /></button>
            </div>
          </form>
        
      </div>
    </div>
   <script>
       function handleSuggestion(suggestion) {
            document.getElementById('question').value = suggestion;
            document.getElementById('questionForm').dispatchEvent(new Event('submit'));
        }
      document
    // Assume the loading image is already present in the HTML and initially hidden
document.getElementById("questionForm").addEventListener("submit", async function (event) {
    event.preventDefault();

    const question = document.getElementById("question").value;
    const messagesContainer = document.getElementById("messages");
    const loadingElement = document.getElementById("loading");
    const loadingImage = document.getElementById("loadingImage");
    const loadingContainer = document.getElementById("centerImageContainer");

    // Add user's question to the chat
    const questionElement = document.createElement("div");
    questionElement.classList.add("message", "question");
    questionElement.textContent = question;
    messagesContainer.appendChild(questionElement);
    document.getElementById("question").value = "";

    // Scroll to the bottom of the messages container
    messagesContainer.scrollTop = messagesContainer.scrollHeight;

    // Hide the loading image immediately after the question is submitted
    loadingImage.style.display = "none";
    loadingContainer.style.display="none"
    loadingElement.style.display = "block";

    try {
        const response = await fetch("https://chat-bot-sap.vercel.app/ask", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ question }),
        });

        if (response.ok) {
            const data = await response.json();
            console.log(data);
            const answer = data.answer || "";

            // Extract only the content part from the answer
            const contentMatch = answer.match(/content=(['"])(.*?)\1/s);
            const content = contentMatch && contentMatch[2] ? contentMatch[2] : "No valid content found in the response.";

            // Add AI's response to the chat
            const answerElement = document.createElement("div");
            answerElement.classList.add("message", "answer");
            answerElement.innerHTML = `
          
          <div style="text-align: center; display:flex; align-items:center; gap:10px;">
       
          <img src="./chatlogo.svg" alt="Error Image" style="width: 32px; height: 32px; ">
        ${content}
        </div>
        `;
            messagesContainer.appendChild(answerElement);
        } else {
            console.error("Network response was not ok.");
            const errorElement = document.createElement("div");
            errorElement.classList.add("message", "answer");
 errorElement.innerHTML = `
       
        <div style="text-align: center; display:flex; align-items:center; gap:10px;">
       
          <img src="./chatlogo.svg" alt="Error Image" style="width: 32px; height: 32px; ">
             Network response was not ok.
        </div>
      `;      
            messagesContainer.appendChild(errorElement);
        }
    } catch (error) {
        console.error("An error occurred while fetching the answer:", error);
        const errorElement = document.createElement("div");
        errorElement.classList.add("message", "answer");
        errorElement.textContent = "An error occurred while fetching the answer.";
        messagesContainer.appendChild(errorElement);
    } finally {
        // Hide loading indicator and ensure the image stays hidden
        loadingElement.style.display = "none";
        loadingImage.style.display = "none";
        loadingContainer.style.display="none"
        // Scroll to the bottom of the messages container
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
});

   </script>
  </body>
</html>
